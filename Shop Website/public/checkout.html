<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Guest Checkout - MystiKraft</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <link rel="stylesheet" href="css/style.css">
  <style>
    .demo-alert {
      border-left: 4px solid #2196F3;
      padding: 15px;
      margin-bottom: 20px;
    }
    .order-item {
      border-bottom: 1px solid #e0e0e0;
      padding: 10px 0;
    }
    .order-item:last-child {
      border-bottom: none;
    }
    .order-summary-card {
      position: sticky;
      top: 20px;
    }
    .section-header {
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #e0e0e0;
    }
  </style>
</head>
<body>
  <header class="center-align section">
    <h1>MystiKraft</h1>
  </header>

  <!-- Navbar -->
  <nav class="white">
    <div class="nav-wrapper container">
      <a href="index.html" class="brand-logo">
        <img src="images/Logo/Logo.jpg" alt="MystiKraft Logo" style="height: 40px; vertical-align: middle;">
        MystiKraft
      </a>
      <ul id="nav-mobile" class="right hide-on-med-and-down">
        <li><a href="index.html">Home</a></li>
        <li><a href="shop.html">Shop</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="contact.html">Contact</a></li>
        <li><a href="search.html">Search</a></li>
        <li class="active">
          <a href="cart.html">
            My Cart <span id="cart-count" class="new badge black">0</span>
          </a>
        </li>
      </ul>
    </div>
  </nav>

  <main class="container section">
    <h2 class="center-align">üõí Guest Checkout</h2>
    
    <div class="demo-alert blue lighten-5">
      <h5>üìã Demo Checkout Process</h5>
      <p>This is a demonstration of the guest checkout functionality. Fill out the form below to simulate placing an order.</p>
    </div>
    
    <div class="row">
      <!-- Customer Information -->
      <div class="col s12 m8">
        <div class="card">
          <div class="card-content">
            <span class="card-title">üë§ Customer Information</span>
            <form id="checkoutForm">
              <div class="row">
                <div class="input-field col s12 m6">
                  <input id="firstName" type="text" class="validate" required>
                  <label for="firstName">First Name *</label>
                </div>
                <div class="input-field col s12 m6">
                  <input id="lastName" type="text" class="validate" required>
                  <label for="lastName">Last Name *</label>
                </div>
              </div>
              <div class="row">
                <div class="input-field col s12 m6">
                  <input id="email" type="email" class="validate" required>
                  <label for="email">Email *</label>
                </div>
                <div class="input-field col s12 m6">
                  <input id="phone" type="tel">
                  <label for="phone">Phone</label>
                </div>
              </div>
              
              <div class="section-header">
                <h6>üè† Shipping Address</h6>
              </div>
              
              <div class="input-field">
                <input id="street" type="text" class="validate" required>
                <label for="street">Street Address *</label>
              </div>
              <div class="row">
                <div class="input-field col s12 m4">
                  <input id="city" type="text" class="validate" required>
                  <label for="city">City *</label>
                </div>
                <div class="input-field col s12 m4">
                  <input id="state" type="text" class="validate" required>
                  <label for="state">State *</label>
                </div>
                <div class="input-field col s12 m4">
                  <input id="zipCode" type="text" class="validate" required>
                  <label for="zipCode">ZIP Code *</label>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
      
      <!-- Order Summary -->
      <div class="col s12 m4">
        <div class="card order-summary-card">
          <div class="card-content">
            <span class="card-title">üì¶ Order Summary</span>
            <div id="order-items">
              <!-- Dynamic cart items will be loaded here -->
              <div class="order-item">
                <div class="row valign-wrapper" style="margin-bottom: 0;">
                  <div class="col s8">
                    <span>Nike Air Max x1</span>
                  </div>
                  <div class="col s4 right-align">
                    <span>$120.00</span>
                  </div>
                </div>
              </div>
              <div class="order-item">
                <div class="row valign-wrapper" style="margin-bottom: 0;">
                  <div class="col s8">
                    <span>Ultraboost x1</span>
                  </div>
                  <div class="col s4 right-align">
                    <span>$220.00</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="divider"></div>
            <div class="order-total" style="margin-top: 15px;">
              <h6>Total: <strong id="order-total-amount">$340.00</strong></h6>
            </div>
            <div class="card-action" style="display: flex; flex-direction: column;">
              <button id="btn-place-order" class="btn green waves-effect waves-light">
                ‚úÖ Complete Guest Checkout
              </button>
              <button id="btn-test-api" class="btn grey waves-effect waves-light" style="margin-top: 10px;">
                üß™ Test Cart API
              </button>
              <a href="cart.html" class="btn-flat waves-effect center-align" style="margin-top: 10px;">Back to Cart</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="page-footer black">
    <div class="container center-align">
      <p>¬© 2025 MystiKraft</p>
      <p>Last Updated: May 5, 2025</p>
      <p>Contact: <a href="mailto:support@mystikraft.com" class="orange-link">support@mystikraft.com</a></p>
    </div>
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script src="js/cart-count.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize Materialize components
      M.updateTextFields();
      
      // Get elements
      const placeOrderBtn = document.getElementById('btn-place-order');
      const testApiBtn = document.getElementById('btn-test-api');
      const checkoutForm = document.getElementById('checkoutForm');
      
      // Test Cart API functionality
      testApiBtn.addEventListener('click', async function() {
        try {
          console.log('üß™ Testing Cart API...');
          
          // Test 1: Get cart
          const cartResponse = await fetch('/api/cart');
          const cart = await cartResponse.json();
          console.log('‚úÖ Cart API Test 1 - Get Cart:', cart);
          
          // Test 2: Add to cart (using first product ID from seeded data)
          const addToCartResponse = await fetch('/api/cart', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ productId: '507f1f77bcf86cd799439011' })
          });
          const addResult = await addToCartResponse.json();
          console.log('‚úÖ Cart API Test 2 - Add to Cart:', addResult);
          
          M.toast({html: 'üß™ Cart API Tests Completed! Check console for details.', classes: 'green'});
          
        } catch (error) {
          console.error('‚ùå Cart API Test failed:', error);
          M.toast({html: '‚ùå Cart API Test failed! Check console for errors.', classes: 'red'});
        }
      });

      // Process checkout
      placeOrderBtn.addEventListener('click', async function() {
        try {
          // Validate form
          if (!checkoutForm.checkValidity()) {
            M.toast({html: 'Please fill all required fields correctly', classes: 'red'});
            return;
          }

          const customerInfo = {
            firstName: document.getElementById('firstName').value,
            lastName: document.getElementById('lastName').value,
            email: document.getElementById('email').value,
            phone: document.getElementById('phone').value,
            address: {
              street: document.getElementById('street').value,
              city: document.getElementById('city').value,
              state: document.getElementById('state').value,
              zipCode: document.getElementById('zipCode').value,
              country: 'Australia'
            }
          };

          // Simulate order creation (since we don't have real cart items yet)
          const mockOrder = {
            orderNumber: 'ORD-' + Date.now() + '-DEMO',
            customerInfo: customerInfo,
            items: [
              { name: 'Nike Air Max', price: 120, quantity: 1 },
              { name: 'Ultraboost', price: 220, quantity: 1 }
            ],
            total: 340,
            status: 'pending',
            createdAt: new Date()
          };

          // Show loading state
          placeOrderBtn.disabled = true;
          placeOrderBtn.innerHTML = '<div class="preloader-wrapper small active"><div class="spinner-layer spinner-green-only"><div class="circle-clipper left"><div class="circle"></div></div><div class="gap-patch"><div class="circle"></div></div><div class="circle-clipper right"><div class="circle"></div></div></div></div> Processing...';

          // Simulate API call delay
          await new Promise(resolve => setTimeout(resolve, 1500));
          
          M.toast({
            html: `üéâ Guest Checkout Completed!<br>Order Number: ${mockOrder.orderNumber}`,
            classes: 'green',
            displayLength: 4000
          });
          
          // Reset form and button
          checkoutForm.reset();
          placeOrderBtn.disabled = false;
          placeOrderBtn.innerHTML = '‚úÖ Complete Guest Checkout';
          
          // Fill demo data again
          fillDemoData();
          
        } catch (error) {
          console.error('Checkout error:', error);
          M.toast({html: '‚ùå Error processing checkout. Please try again.', classes: 'red'});
          placeOrderBtn.disabled = false;
          placeOrderBtn.innerHTML = '‚úÖ Complete Guest Checkout';
        }
      });

      // Add demo data to form
      function fillDemoData() {
        document.getElementById('firstName').value = 'John';
        document.getElementById('lastName').value = 'Doe';
        document.getElementById('email').value = 'john.doe@example.com';
        document.getElementById('phone').value = '0412345678';
        document.getElementById('street').value = '123 Main Street';
        document.getElementById('city').value = 'Melbourne';
        document.getElementById('state').value = 'VIC';
        document.getElementById('zipCode').value = '3000';
        
        // Trigger Materialize label animation
        M.updateTextFields();
      }

      // Initialize with demo data
      fillDemoData();
    });
  </script>
</body>
</html>